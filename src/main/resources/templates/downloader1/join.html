<!DOCTYPE html>
<html lang="kr" xmlns:sec="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:replace="~{common/header :: headerFragment}"></th:block>
</head>
<body>
    <main>
        <div class="container mt-4">
            <!--ğŸ‘‡ì—¬ê¸°ì— ë‚´ìš© ë„£ì–´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤ğŸ‘‡-->
            <section class="py-5">
                <div class="container px-5">
                    <!-- login form-->
                    <div class="bg-light rounded-3 py-5 px-4 px-md-5 mb-5">
                        <div class="row gx-5 justify-content-center">
                            <div class="col-lg-8 col-xl-6">
                                <h1 class="text-center mb-5">íšŒì›ê°€ì… í˜ì´ì§€</h1>
                                <form id="registerForm" onsubmit="return false">
                                    <div class="form-floating mb-3">
                                        <input class="form-control" id="email" name="email" type="text" onkeyup="emailValidCk()" maxlength="30" required placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”">
                                        <button class="btn btn-info" id="duplicateCkForEmail" onclick="duplicateCkForEmailFnc()">ì´ë©”ì¼ ì¤‘ë³µí™•ì¸</button>
                                        <span id="emailCkMsg"></span>
                                        <label for="email">ì´ë©”ì¼</label>
                                    </div>
                                    <div class="form-floating mb-3">
                                        <input class="form-control" id="password" name="password" type="password" onkeyup="passwordValidCkFnc()" maxlength="20" required placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
                                        <label for="password">íŒ¨ìŠ¤ì›Œë“œ</label>
                                    </div>
                                    <div class="form-floating mb-3">
                                        <input class="form-control" id="passwordCk" name="passwordCk" type="password" maxlength="20" required placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸">
                                        <button class="btn btn-info" id="passwordMatchCk" onclick="passwordMatchCkFnc()">íŒ¨ìŠ¤ì›Œë“œ ì¼ì¹˜ì—¬ë¶€ í™•ì¸</button>
                                        <span id="passwordCkMsg"></span>
                                        <label for="passwordCk">íŒ¨ìŠ¤ì›Œë“œ í™•ì¸</label>
                                    </div>
                                    <div class="form-floating mb-3">
                                        <input class="form-control" id="nickName" name="nickName" type="text" onkeyup="nickNameValidFunc()" maxlength="30" required placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”">
                                        <button class="btn btn-info" id="duplicateCkForNickname" onclick="duplicateCkForNicknameFnc()">ë‹‰ë„¤ì„ ì¤‘ë³µí™•ì¸</button>
                                        <span id="nickNameCkMsg"></span>
                                        <label for="nickName">ë‹‰ë„¤ì„</label>
                                    </div>
                                    <div class="d-grid"><button class="btn btn-primary btn-lg" id="submitBtn" type="button">íšŒì›ê°€ì…</button></div>
                                    <div style="margin-top: 16px; text-align: right"><a href="/safe-ride/login">ë¡œê·¸ì¸</a></div>
                                    <div style="margin-top: 16px; text-align: right">
                                        <a href="/">í™ˆìœ¼ë¡œ</a>
                                    </div>
                                </form>
                            </div>
                        </div>

                    </div>
                </div>
            </section>
            <!--ğŸ‘†ì—¬ê¸°ì— ë‚´ìš© ë„£ì–´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤ğŸ‘†-->
        </div>
    </main>
    <script>


        //ì•„ì´ë”” ì •ê·œì‹ ì²´í¬ìš© flagë³€ìˆ˜
        let idCk = false;
        //ì•„ì´ë”” ì¤‘ë³µí™•ì¸ìš© flagë³€ìˆ˜
        let idDuplicateCk = false;
        //íŒ¨ìŠ¤ì›Œë“œ ì •ê·œì‹ ì²´í¬ìš© flagë³€ìˆ˜
        let passwordCk = false;
        //íŒ¨ìŠ¤ì›Œë“œ ì¤‘ë³µí™•ì¸ìš© flagë³€ìˆ˜
        let passwordMatchCk = false;
        //ë‹‰ë„¤ì„ ì •ê·œì‹ ì²´í¬ìš© flagë³€ìˆ˜
        let nicknameCk = false;
        //ë‹‰ë„¤ì„ ì¤‘ë³µí™•ì¸ìš© flag ë³€ìˆ˜
        let nicknameDuplicateCk = false;
        //ì´ë©”ì¼ ì •ê·œì‹ ì²´í¬ìš© flagë³€ìˆ˜
        let emailCk = false;
        //ì´ë©”ì¼ ì¤‘ë³µí™•ì¸ìš© flag ë³€ìˆ˜
        let emailDuplicateCk = false;

        //ë‹‰ë„¤ì„ ì¤‘ë³µí™•ì¸
        function duplicateCkForNicknameFnc(){
            let nickName = $('#nickName').val();
            if(nickName.trim()===''){
                alert('ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
            } else {
                $.ajax({
                    type : "POST",
                    url : "/duplicateCkForNickname",
                    data : {
                        nickName : nickName
                    },
                    success : function (result){
                        if (result===true){ // ë‹‰ë„¤ì„ì´ ì´ë¯¸ ì¡´ì¬í•œë‹¤ë©´
                            alert("ì‚¬ìš© ë¶ˆê°€ëŠ¥í•œ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤.");
                            nicknameDuplicateCk = false;
                        } else if(result===false) {
                            alert("ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.");
                            nicknameDuplicateCk = true;
                        } else {
                            alert("ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")
                        }
                    },
                    error:function (error){
                        alert("ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”!" + error);
                    }
                });
            }
        }

        //ì´ë©”ì¼ ì¤‘ë³µí™•ì¸
        function duplicateCkForEmailFnc(){

            let email = $('#email').val();
            if(email.trim()===''){
                alert('ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
            } else {
                $.ajax({
                    type : "POST",
                    url : "/duplicateCkForEmail",
                    data : {
                        email : email
                    },
                    success : function (result){
                        if (result===true){ // ì´ë©”ì¼ì´ ì´ë¯¸ ì¡´ì¬í•œë‹¤ë©´
                            alert("ì‚¬ìš© ë¶ˆê°€ëŠ¥í•œ ì´ë©”ì¼ì…ë‹ˆë‹¤.");
                            emailDuplicateCk = false;
                        } else if(result===false) {
                            alert("ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.");
                            emailDuplicateCk = true;
                        } else {
                            alert("ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")
                        }
                    },
                    error:function (error){
                        alert("ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”!" + error);
                    }
                });
            }
        }

        //íšŒì›ê°€ì… ë²„íŠ¼ í´ë¦­ ì‹œ ë™ì‘
        $('#submitBtn').click(function (event){
            //ê¸°ë³¸ í¼ ì œì¶œ ë°©ì§€
            event.preventDefault();
            //ìœ ì € ì…ë ¥ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const emailVal = $('#email').val();
            const passwordVal = $('#password').val();
            const passwordCkVal = $('#passwordCk').val();
            const nickNameVal = $('#nickName').val();

            if (
                emailVal.trim()===''||
                passwordVal.trim()===''||
                passwordCkVal.trim()===''||
                nickNameVal.trim()===''
            ){
                alert("ë¹„ì–´ìˆëŠ” ê°’ì´ ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”!");
            }
            //ì´ë©”ì¼ ì •ê·œì‹ ì²´í¬ ì—¬ë¶€ í™•ì¸
            if (emailCk !== true){
                alert("ì˜¬ë°”ë¥¸ ì´ë©”ì¼ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”!")
            }
            //ì´ë©”ì¼ ì¤‘ë³µì²´í¬ ì—¬ë¶€ í™•ì¸
            else if (emailDuplicateCk!==true){
                alert("ì´ë©”ì¼ ì¤‘ë³µì²´í¬ë¥¼ ì§„í–‰í•´ì£¼ì„¸ìš”!")
            }
            //ë¹„ë°€ë²ˆí˜¸ ì •ê·œì‹ ì²´í¬ ì—¬ë¶€ í™•ì¸
            else if (passwordCk !== true){
                alert("ì˜¬ë°”ë¥¸ ë¹„ë°€ë²ˆí˜¸ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”!")
            }
            //ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜ ì²´í¬ ì—¬ë¶€ í™•ì¸
            else if (passwordMatchCk !== true){
                alert("ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜ ì²´í¬ë¥¼ ì§„í–‰í•´ì£¼ì„¸ìš”!")
            }
            //ë‹‰ë„¤ì„ ì •ê·œì‹ ì²´í¬ ì—¬ë¶€ í™•ì¸
            else if (nicknameCk !== true){
                alert("ì˜¬ë°”ë¥¸ ë‹‰ë„¤ì„ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”!")
            }
            //ë‹‰ë„¤ì„ ì¤‘ë³µì²´í¬ ì—¬ë¶€ í™•ì¸
            else if (nicknameDuplicateCk !== true){
                alert("ë‹‰ë„¤ì„ ì¤‘ë³µì²´í¬ë¥¼ ì§„í–‰í•´ì£¼ì„¸ìš”!")
            }
            else {
                const formData = {
                    email: emailVal,
                    password: passwordVal,
                    nickName: nickNameVal
                };

                $.ajax({
                    type : "POST",
                    url : "/join",
                    contentType: "application/json",
                    data: JSON.stringify(formData),
                    success : function (result){
                        alert("íšŒì›ê°€ì…ë˜ì…¨ìŠµë‹ˆë‹¤!");
                        window.location.href = "/login";
                    },
                    error:function (error){
                        alert("ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤." + error);
                    }
                });
            }
        });
        //  });


        //ì•„ì´ë”” ì •ê·œì‹
        function idValidCk() {
            //ì˜ë¬¸ìë¡œ ì‹œì‘í•˜ëŠ” ì˜ë¬¸ì ë˜ëŠ” ìˆ«ì 6~20ì
            const regExp = /^[a-z]+[a-z0-9]{5,19}$/g;
            let userId = $('#userId').val(); // idê°’
            let idCkMsg = $('#idCkMsg');
            if (!regExp.test(userId)){
                idCkMsg.text("ì‚¬ìš©ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤!(ì˜ë¬¸ìì‹œì‘ 6~20ì ì´ë‚´)");
                idCkMsg.css('color', "red");
                idCk = false;
            } else {
                idCkMsg.text("ì‚¬ìš©ê°€ëŠ¥í•©ë‹ˆë‹¤!!");
                idCkMsg.css('color', "blue");
                idCk = true;
            }
        }

        //ë¹„ë°€ë²ˆí˜¸ ì •ê·œì‹
        function passwordValidCkFnc() {
            //ì˜ì–´ ìˆ«ì ì¡°í•© 8ìë¦¬ ì´ìƒ~25ì ì´í•˜
            const regExp = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,20}$/;
            let password = $('#password').val();
            let passwordCkMsg = $('#passwordCkMsg');
            if (!regExp.test(password)){
                passwordCkMsg.text("ì˜ì–´ ìˆ«ì ì¡°í•© 8~20ì ì´ë‚´ë¡œ í•´ì£¼ì„¸ìš”!");
                passwordCkMsg.css('color', "red");
                passwordCk = false;
            } else {
                passwordCkMsg.text("ì‚¬ìš©ê°€ëŠ¥í•©ë‹ˆë‹¤!!");
                passwordCkMsg.css('color', "blue");
                passwordCk = true;
            }
        }

        //ì´ë©”ì¼ ì •ê·œì‹
        function emailValidCk() {
            //
            const regExp = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/i;
            let userId = $('#email').val(); // idê°’
            let emailCkMsg = $('#emailCkMsg');
            if (!regExp.test(userId)){
                emailCkMsg.text("ì‚¬ìš©ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤!");
                emailCkMsg.css('color', "red");
                emailCk = false;
            } else {
                emailCkMsg.text("ì‚¬ìš©ê°€ëŠ¥í•©ë‹ˆë‹¤!!");
                emailCkMsg.css('color', "blue");
                emailCk = true;
            }
        }

        //ë‹‰ë„¤ì„ ì •ê·œì‹
        function nickNameValidFunc(){
            //ì˜ë¬¸ ëŒ€/ì†Œë¬¸ìë‚˜ í•œê¸€ë¡œ ì‹œì‘. ì˜ë¬¸ ëŒ€/ì†Œë¬¸ìì™€ í•œê¸€, ìˆ«ìë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©°
            const regExp =/^[ã„±-ã…ê°€-í£a-zA-Z0-9]{2,10}$/;
            //2~10ì‚¬ì´ì˜ ê¸¸ì´

            let nickName = $('#nickName').val();
            let nickNameCkMsg = $('#nickNameCkMsg');
            if (!regExp.test(nickName)){
                nickNameCkMsg.text("2~10ì ì´ë‚´ë¡œ í•´ì£¼ì„¸ìš”!(íŠ¹ìˆ˜ë¬¸ìë¶ˆê°€)");
                nickNameCkMsg.css('color', "red");
                nicknameCk = false;
            } else {
                nickNameCkMsg.text("ì‚¬ìš©ê°€ëŠ¥í•©ë‹ˆë‹¤!!");
                nickNameCkMsg.css('color', "blue");
                nicknameCk = true;
            }
        }

        //íŒ¨ìŠ¤ì›Œë“œ ì¼ì¹˜ì—¬ë¶€ í™•ì¸
        function passwordMatchCkFnc() {
            //ë¹„ë°€ë²ˆí˜¸ ì²´í¬
            let password = document.querySelector("#password").value;
            let passwordCk = document.querySelector("#passwordCk").value;
            if (password !== passwordCk || password === '' || passwordCk === ''){
                alert("íŒ¨ìŠ¤ì›Œë“œê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤!");
                passwordMatchCk = false;
            } else {
                alert("íŒ¨ìŠ¤ì›Œë“œê°€ ì¼ì¹˜í•©ë‹ˆë‹¤! ^^");
                passwordMatchCk = true;
            }
        }

    </script>
</body>
</html>